{% extends "base.html" %}
{% load form_filters %}

{% block title %}{{ post.title }} | Blog{% endblock %}

{% block content %}
<article class="mb-4 p-3 border rounded bg-white shadow-sm">
    <h1 class="mb-3">{{ post.title }}</h1>
    <p class="text-muted">
        <i class="fas fa-user"></i> {{ post.author }} |
        <i class="fas fa-calendar-alt"></i> {{ post.published_at|date:"d/m/Y H:i" }}
    </p>
    <hr>
    <div>{{ post.content|linebreaks }}</div>
</article>

<section class="mb-4">
    <h2 class="h4 mb-3"><i class="fas fa-comments"></i> Comentários</h2>
    {% for comment in comments %}
    <div class="mb-3 p-3 border rounded bg-light d-flex">
        {% if comment.user.profile.photo %}
        <img src="{{ comment.user.profile.photo.url }}" class="rounded-circle me-3"
             alt="Foto de {{ comment.user.username }}" width="48" height="48">
        {% else %}
        <i class="fas fa-user-circle fa-2x text-secondary me-3"></i>
        {% endif %}
        <div>
            <strong>{{ comment.user.username }}</strong><br>
            <small class="text-muted">{{ comment.created_at|date:"d/m/Y H:i" }}</small>
            <p class="mb-0 mt-2">{{ comment.content|linebreaks }}</p>
        </div>
    </div>
    {% empty %}
    <p>Sem comentários ainda.</p>
    {% endfor %}
</section>

<hr>

<section>
    <h2 class="h4">Deixe um comentário</h2>

    {% if form.errors %}
    <div class="alert alert-danger">
        <strong>Corrija os erros abaixo:</strong>
    </div>
    {% endif %}

    {% if user.is_authenticated %}
    <form method="post" class="mt-3">
        {% csrf_token %}
        <div class="mb-3">
            {{ form.content.label_tag }} {{ form.content|add_class:"form-control" }}
        </div>
        <button type="submit" class="btn btn-primary" aria-label="Enviar comentário">
            <i class="fas fa-paper-plane"></i> Enviar
        </button>
    </form>
    {% else %}
    <p class="text-muted">
        Você precisa estar <a href="{% url 'login' %}?next={{ request.path }}">logado</a> para comentar.
    </p>
    {% endif %}
</section>
{% endblock %}
